트리거: 정기적(5초 간격) 환경 센서 측정 또는 관리자의 온도 설정 변경

참여자: Env Controller, TCP Handler, Service Layer, DB, GUI

Flow:

창고별 상태  확인

기준치 : 사용자가 고정된 범위안에서 설정한 온도

고정된 범위:

냉동 창고(A) min, max 온도: -15 ~ -25℃

냉장 창고(B) min, max 온도 : 0 ~ 10℃

상온 창고(C)min, max 온도 : 15 ~ 25℃

GUI에서 창고별 고정된 min, max 온도 사이에서 기준치값 설정시 

기준치값은 API Server → Server → TCP_Server → env_controller로 전송

 env_controller에서 5초주기로 온도 센서를 통해 온도 값을 측정하여 기준치와 상태판단

측정값의 상태 판단:

대기 모드 : 기준치값 (±2℃) 이내

냉방 모드 :

1단계 : 기준치값  +2℃초과 +4℃ 이내 

2 단계 : 기준치값  +4℃초과 +6℃ 이내 

3 단계 :기준치값  +6℃초과 

난방 모드 :

1단계 : 기준치값  -2℃ 미만 -4℃ 이내 

2 단계 : 기준치값  -4℃ 미만 -6℃ 이내 

3 단계 : 기준치값  -6℃ 미만

경고 상태 : 창고마다 고정된 min, max 범위 벗어난 값

Env Controller는 TCP_Handler → Server Layer → API Server → GUI에  

 해당 창고, 측정값, 온도 제어 단계 , 정상/경고 상태, 시간 기록

경고상태시  DB에 해당 창고, 온도, ddtm 저장 (temp_warning_logs 테이블)

GUI는 받은 데이터를 대시보드, 창고환경 페이지에  업데이트:

대시보드 :  해당 창고, 측정값, 정상/경고 상태  (정상: 녹색, 경고: 빨간색)

창고환경 :  해당 창고, 측정값, 온도제어 단계(냉방: blue, 난방 : red, 정지: gray), 정상/경고 상태  (정상: green, 경고: red)

팬 제어 명령 결정

Env Controller에서 온도제어 단계 ,  및 세기 결정 후 해당 창고의 팬 속도 조절 및 LED 제어

냉방 모드:  : 팬 작동(단계별 세기증가) + 파란색 LED ON + 빨간색 LED OFF

난방 모드: 

A,B 창고 : 팬 정지 + 모든 LED OFF

C 창고    :  팬 작동(단계별 세기증가) + 빨간색 LED ON  + 파란색 LED OFF

정지 모드: 팬 정지 + 모든 LED OFF

Env Controller는 처리 후 TCP Handler를 통해  Service Layer에게 온도 제어단계 전송.

5. 경고 상태 처리

경고 상태 발생 시 해당 Env Controller로 경고 명령 전송

Env Controller는 노란색 LED 깜빡임 및 부저 작동

정상 상태 복귀 시 경고 장치 비활성화 명령 전송

선택 분기점:

온도 상태: 정상/경고/위험에 따른 제어 및 표시 방식 변경

팬 제어 모드: 냉방(파란 LED)/난방(빨간 LED)/정지에 따른 하드웨어 제어

예외 상태: 센서 오류/통신 장애 발생 시 처리 방식

예외 상황:

센서 오류: 측정값 비정상 시 이전 값 유지, 오류 표시

통신 장애: 10초 이상 데이터 미수신 시 장애 표시, 재연결 시도