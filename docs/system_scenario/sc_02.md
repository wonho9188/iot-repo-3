SC_02. 물품 입고 및 바코드 기반 자동 분류 시나리오
트리거:
컨베이어 벨트 입구 IR 센서에 물품 감지
참여자:
Sort Controller(ESP32), TCP Handler, Service Layer, DB, GUI
Flow:

1. 물품 감지 및 카운트 증가
Sort Controller의 입구 IR 센서가 물품 감지
Sort Controller는 TCP 메시지를 TCP Handler로 전송
메시지에는 센서 ID(entry), 감지 상태(1=감지됨) 포함
TCP Handler가 수신하여 Service Layer로 전달
Service Layer는 이벤트 수신 시 입고 대기 물품 수를 1 증가시킴
Socket.IO를 통해 GUI에 업데이트된 카운트를 전송
GUI는 대기 물품 수를 1로 표시하고 진행 표시줄을 업데이트

2. 바코드 스캔 및 분류
물품이 esp cam 위치에 도달하면 Sort Controller가 스캔 실행
스캔된 바코드 정보를 TCP 메시지로 전송
TCP Handler가 이 메시지를 Service Layer로 전달
Service Layer는 바코드 데이터 파싱:

보관종류: 첫 1자리 (1: 냉동/A, 2: 냉장/B, 3: 상온/C)
물품번호: 다음 2자리
유통기한: 다음 6자리 (YYMMDD 형식)

물품번호에 따라 창고 결정 (냉동/냉장/상온)
DB에서 해당 창고의 비어있는 선반 위치 조회
가장 번호가 작은 빈 선반을 할당
TCP Handler를 통해 Sort Controller에 분류 명령 전송
명령에는 분류할 구역 정보(A/B/C/E) 포함

3. 분류 실행 및 결과 처리
Sort Controller는 명령을 수신하고 해당 구역의 서보모터 작동
서보모터가 물품을 지정된 분류대로 밀어냄
분류대에 설치된 IR 센서가 물품 통과를 감지
감지 결과를 TCP 메시지로 전송
TCP Handler가 메시지를 Service Layer로 전달
Service Layer는 이벤트 수신 시:

대기 물품 수 1 감소
처리된 물품 수 1 증가
DB에 물품 정보 저장 분류, 창고, 유통기한 등)


Socket.IO를 통해 GUI에 분류 결과와 업데이트된 카운트 전송
GUI는 대기 수량, 처리 수량을 업데이트하고 물품 로그에 새 항목 추가

선택 분기점:

물품 분류: 물품번호 범위에 따라 A/B/C 창고 중 하나로 분류
분류 감지: IR 센서가 물품을 감지하면 성공, 감지하지 못하면 물품 분실로 처리

예외 상황:
바코드 오류:

Sort Controller가 바코드를 인식하지 못하면 오류 이벤트를 전송
Service Layer는 해당 물품을 오류물품 분류대(E)로 보냄
Socket.IO를 통해 GUI에 바코드 오류 알림 표시

 

 