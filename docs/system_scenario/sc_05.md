SC_05. RFID 기반 출입 관리 시나리오
트리거:
Gate Package의 RFID 센서가 카드 태그 감지
참여자:
Access Controller, TCP Handler, Service Layer, DB, GUI(Flask)
Flow:
1. RFID 카드 인식

직원이 게이트에 RFID 카드를 태그
Access Controller(하드웨어)의 RFID 리더가 카드 UID 인식
Access Controller는 인식 즉시 RFID 리더를 일시적으로 비활성화 (중복 인식 방지)
Access Controller는 인식된 UID 데이터를 TCP 메시지로 패키징
패키징된 메시지는 TCP 통신을 통해 서버의 TCP Handler로 전송
TCP Handler는 수신한 메시지에서 device 식별자를 확인하고 메시지를 파싱
파싱된 RFID 태그 이벤트 데이터는 Service Layer로 전달

2. 직원 인증 및 출입 제어

Service Layer는 전달받은 UID를 DB 계층에 질의
DB 계층은 해당 UID에 매칭되는 직원 정보와 권한 정보를 조회
조회 결과가 DB 계층에서 Service Layer로 반환
Service Layer는 직원 인증 로직을 수행:

등록된 직원이고 권한이 있는 경우 승인 결정
미등록 직원이거나 권한이 없는 경우 거부 결정


결정된 제어 명령(승인/거부)이 Service Layer에서 TCP Handler로 전달
TCP Handler는 명령을 TCP 메시지로 변환하여 Access Controller로 전송
Access Controller는 수신한 명령에 따라 하드웨어 제어:

승인 시:

녹색 LED 3번 깜빡임
서보모터 작동하여 출입문 열림 (작동 시간: 2초)
확인음 재생


거부 시:

적색 LED 3번 깜빡임
출입문 잠금 유지 (서보모터 미작동)




서보모터 작동 중 및 완료 후 추가 카드 태그 방지를 위해 RFID 리더 비활성 상태 유지
서보모터 작동 완료 후 출입문이 닫히면(2초 후) Access Controller는 결과를 TCP 메시지로 서버에 응답
응답 전송 후 RFID 리더를 다시 활성화하여 다음 카드 인식 준비
TCP Handler는 응답을 수신하여 Service Layer에 전달

3. 출입 기록 및 GUI 업데이트 (승인된 경우만)

승인된 경우에만, Service Layer는 인증 결과와 직원 정보를 DB 계층에 전달
DB 계층은 출입 기록 테이블에 새 레코드 추가:

직원 카드 ID 저장
출입 시간 저장
이전 기록을 조회하여 입장/퇴장 상태 결정 및 저장


저장 완료 후 DB 계층은 Service Layer에 완료 신호 반환
Service Layer는 Socket.IO를 통해 출입 이벤트 데이터 전달
Socket.IO는 데이터를 브로드캐스트 메시지로 변환하여 연결된 모든 GUI 클라이언트에 전송
GUI 클라이언트는 Socket.IO 메시지를 수신하여 화면 업데이트:

출입 관리 페이지의 목록 갱신
대시보드의 현재 인원 수 갱신
실시간 알림 영역에 출입 정보 표시



선택 분기점:

인증 결과 분기: 등록된 직원 + 권한 있음 → 승인, 그 외 → 거부
출입 상태 분기: 이전 기록 입장 → 퇴장, 이전 기록 퇴장/없음 → 입장
하드웨어 상태 분기: 서보모터 작동 중 → RFID 리더 비활성, 서보모터 정지 → RFID 리더 활성화

예외 상황:

RFID 읽기 오류:

Access Controller에서 읽기 오류 감지 시 서버로 오류 데이터 전송
Service Layer에서 로그만 기록하고 처리 중단


서보모터 동작 중 재인식 시도:

서보모터 작동 중에는 RFID 리더가 비활성화되어 있으므로 무시됨


서보모터 오작동:

서보모터 동작 실패 시 Access Controller는 오류 상태를 서버에 보고
Service Layer는 Socket.IO를 통해 관리자에게 알림


통신 장애:

서버-Access Controller 간 통신 실패 시 Access Controller는 로컬 판단으로 기본 동작(거부) 수행


입장/퇴장 상태 전환:

Service Layer는 직원의 마지막 기록 상태를 확인
마지막 기록이 입장이면 현재 기록을 퇴장으로 등록
마지막 기록이 퇴장이거나 기록이 없으면 현재 기록을 입장으로 등록