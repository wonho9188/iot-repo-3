SC_01. 분류 작업 시작 및 제어 시나리오 (단순화 버전)
트리거: (Sort → TCP)
컨베이어 벨트 앞 적외선 센서가 물품 감지

분류대 센서가 물품 감지

대기 물품이 0인 상태에서 7초 경과

참여자:
GUI(PyQt6), API Server(Flask), Service Layer, TCP Handler, Sort Controller(ESP32), DB

Flow:
1. 작동 시작 (적외선 센서 감지)
컨베이어 벨트 입구의 적외선 센서가 물품 감지

Sort Controller는 TCP Handler를 통해 물품 감지 이벤트 전송: 

Service Layer는 이벤트 수신 시: 

분류기 상태가 "STOPPED"인 경우, 상태를 "RUNNING"으로 변경

대기 물품 수를 1 증가

Socket.IO를 통해 GUI에 상태 업데이트 전송

GUI는 상태를 "작동 중"으로 표시, 대기 물품 수를 1로 업데이트

2. 분류 완료 및 대기 물품 처리
물품이 분류대(A,B,C,D,E 중 하나)의 센서에 감지됨

Sort Controller는 TCP Handler를 통해 분류 감지 이벤트 전송: 

Service Layer는 이벤트 수신 시: 

대기 물품 수를 1 감소 (0이 될 수 있음)

처리 물품 수를 1 증가

해당 분류대의 물품 수 카운터 증가

Socket.IO를 통해 GUI에 업데이트 전송

GUI는 대기 물품 수, 처리 물품 수, 분류대별 물품 수를 업데이트

3. 자동 정지 (7초 타이머)
대기 물품 수가 0인 상태에서 7초 동안 새 물품 미감지

Sort Controller에서 타이머 작동, 7초 후 자동 정지 실행: 

컨베이어 벨트 모터 정지

자동 정지 이벤트 메시지를 TCP Handler로 전송: 

Service Layer는 자동 정지 이벤트 수신 시: 

분류기 상태를 "STOPPED"로 변경

Socket.IO를 통해 GUI에 자동 정지 알림 전송

GUI는 상태를 "정지"로 표시

상태 전환:
정지(STOPPED) → 작동 중(RUNNING): 입구 적외선 센서 물품 감지 시

작동 중(RUNNING) → 정지(STOPPED): 대기 물품 0 + 7초 미감지

핵심 변수:
대기 물품 수: 입구 센서 감지 시 +1, 분류대 센서 감지 시 -1

처리 물품 수: 분류대 센서 감지 시 +1

분류대별 물품 수: 각 분류대(A,B,C,D,E) 센서 감지 시 해당 분류대 카운터 +1

상태 업데이트:
모든 상태 변화 및 카운터 변화는 Socket.IO를 통해 실시간으로 GUI에 전송

중요 이벤트(시작, 정지, 물품 처리)는 DB에 로그 기록