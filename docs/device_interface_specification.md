초경량 TCP 통신 프로토콜 (최종 간소화 버전)

1. 기본 메시지 구조

필드명

크기

설명

디바이스 ID

1 바이트

송신 장치 식별자 ('S' # 분류기,

                           'H', # 창고환경

                           'G', #  입출입

                           'M' # 서버)

메시지 타입

1 바이트

메시지 종류 ('C' # 명령,

                    'E' # 이벤트, 

                    'R' # 응답 ,

                    'X' # 에러)

페이로드

가변

간결한 명령/이벤트 데이터 (종료 문자 '\n'으로 구분)

2. 디바이스별 통신 규칙

2.1 분류기 (Sort Controller, 'S')

이벤트 (분류기 → 서버)

SEir1\n       // 입구 IR 센서 감지 (1=감지됨)
SEbcA12123456\n  // 바코드 인식 (1자리=구역, 2자리=물품번호, 6자리=유통기한)
SEssA\n       // 분류 완료 (A, B, C, D, E 중 하나의 구역)
SEas\n         // 자동 정지 발생

명령 (서버 → 분류기)

SCst\n         // 분류기 시작
SCsp\n         // 분류기 정지
SCps\n         // 일시정지 
SCsoA\n       // 물품 분류 (A, B, C, D, E 중 하나의 구역으로)

응답 (분류기 → 서버)

SRok\n         // 명령 성공
SXe1\n         // 오류 코드 1 (통신 오류)
SXe2\n         // 오류 코드 2 (센서 오류)

2.2 창고 환경 제어 (House Controller, 'H')

이벤트 (하우스 → 서버)

HEtp-18.5;4.2;21.3\n  // 모든 창고 온도 데이터 (세미콜론으로 구분)
HEwA1\n      // A 창고 경고 (1=경고, 0=정상)
HEwB1\n      // B 창고 경고
HEwC1\n      // C 창고 경고
HEAC2\n      // A 창고 온도제어상태 (C=냉방, H= 난방, 
                                  0=정지, 1=저속, 2=중속, 3=고속)
HEAC2\n      // A 창고 온도제어상태 (C=냉방, H= 난방, 
                                  0=정지, 1=저속, 2=중속, 3=고속)
HEBC2\n      // A 창고 온도제어상태 (C=냉방, H= 난방, 
                                  0=정지, 1=저속, 2=중속, 3=고속)
HEAC2\n      // A 창고 온도제어상태 (C=냉방, H= 난방, 
                                  0=정지, 1=저속, 2=중속, 3=고속)                                  

명령 (서버 → 하우스)

HCpA-20\n     // A 창고 목표 온도 설정
HCpB5\n       // B 창고 목표 온도 설정
HCpC22\n      // C 창고 목표 온도 설정

응답 (하우스 → 서버)

HRok\n        // 명령 성공
HXe1\n        // 오류 코드 1 (센서 오류)

2.3 출입 제어 (Gate Controller, 'G')

이벤트 (게이트 → 서버)

GEidABC123\n  // RFID 카드 인식 (카드 ID)

명령 (서버 → 게이트)

GCac1\n      // 출입 허용 여부 (1=허용, 0=거부)

응답 (게이트 → 서버)

GRok\n        // 명령 성공
GXe1\n        // 오류 코드 1 (RFID 오류)

3. 디자인 특징

초경량 형식:

타임스탬프 제거

모든 키를 최소 1-2자로 축소

파이프(|) 문자로 필드 구분

줄바꿈(\n)으로 메시지 종료

파싱 용이성:

디바이스와 메시지 타입은 첫 두 문자로 쉽게 식별

키=값 형식 유지로 의미 파악 가능

파싱 로직이 간단함

데이터 최소화:

대부분의 메시지가 10바이트 미만

온도 데이터 같은 복합 정보만 약간 길어짐

분리자 사용:

필드 구분: 파이프(|)

메시지 종료: 줄바꿈(\n)

다중 값 구분: 세미콜론(;)

4. 통신 흐름 예시

분류기 작동 시작 및 물품 분류

M → S: SCst\n                 // 서버가 분류기에 시작 명령
S → M: SRok\n                 // 분류기 응답 성공
S → M: SEir\n               // 물품 감지
S → M: SEbcA12123456\n        // 바코드 읽음
M → S: SCsoA\n               // 서버가 A구역으로 분류 명령
S → M: SEssA\n               // A구역 분류 완료

창고 온도 모니터링 및 제어

H → M: HEtp-18.5;4.2;21.3\n  // 현재 온도 보고
M → H: HCpA-20\n              // A창고 온도 설정
H → M: HRok\n                 // 설정 성공
H → M: HEwA=1\n               // A창고 경고 발생

출입 제어

G → M: GEidABC123\n          // RFID 카드 인식
M → G: GCac1\n               // 출입 허용
G → M: GRok\n                 // 명령 성공

5. 구현 시 주의사항

종료 문자 처리:

모든 메시지는 줄바꿈(\n)으로 종료

수신 버퍼에서 줄바꿈까지 읽어 메시지 경계 확인

파싱 로직:

첫 글자: 디바이스 ID

세 번째 글자: 메시지 타입

나머지: 키=값 형태의 페이로드 (있는 경우)

오류 처리:

메시지 형식이 잘못된 경우: 무시하거나 오류 응답

수신 타임아웃: 재전송 메커니즘 필요